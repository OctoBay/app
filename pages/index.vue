<template>
  <div class="content card overflow-hidden border-0 shadow-sm">
    <div class="d-flex justify-content-around mt-4 px-2">
      <a href="#" :class="'mx-2 text-' + (view === 'send' ? 'primary' : 'muted')" @click="$store.commit('setView', 'send')">Send</a>
      <a href="#" :class="'mx-2 text-' + (view === 'issues' ? 'primary' : 'muted')" @click="$store.commit('setView', 'issues')">Pinboard</a>
      <!-- <a href="#" :class="'mx-2 text-' + (view === 'contributors' ? 'primary' : 'muted')" @click="$store.commit('setView', 'contributors')">Contributors</a> -->
      <a href="#" :class="'mx-2 text-' + (view === 'claim' ? 'primary' : 'muted')" @click="$store.commit('setView', 'claim')">
        {{ registeredAccount === account ? 'Claim' : 'Register' }}
      </a>
      <a href="#" :class="'mx-2 text-' + (view === 'admin' ? 'primary' : 'muted-light')" @click="$store.commit('setView', 'admin')" v-if="account && account === owner">
        <font-awesome-icon :icon="['fas', 'sliders-h']" />
      </a>
    </div>
    <transition name="fade" mode="out-in">
      <keep-alive>
        <SendForm v-if="view == 'send'" />
        <IssuesList v-else-if="view == 'issues'" />
        <Contributors v-else-if="view == 'contributors'" />
        <Claim v-else-if="view == 'claim'" />
        <Admin v-else-if="account && account === owner && view == 'admin'" />
      </keep-alive>
    </transition>
  </div>
</template>

<script>
import { mapGetters } from "vuex"

export default {
  transition: 'fade',
  computed: {
    ...mapGetters(['view', 'account', 'registeredAccount', 'redirectPrefills', 'owner']),
    ...mapGetters('github', { githubUser: 'user' })
  },
  created() {
    if (this.redirectPrefills) {
      if (this.redirectPrefills.type.startsWith('send')) {
        this.$store.commit('setView', 'send')
      }
    }
  },
  watch: {
    githubUser() {
      if (this.githubUser) {
        this.$octoBay.methods.userIDsByGithubUser(this.githubUser.login).call().then(userId => {
          if (userId) {
            this.$octoBay.methods.users(userId).call().then(result => {
              if (result.ethAddress !== "0x0000000000000000000000000000000000000000" && result.status === '2') {
                this.$store.commit('setRegisteredAccount', result.ethAddress)
              } else {
                this.$store.commit('setRegisteredAccount', null)
              }
            }).catch(() => {
              this.$store.commit('setRegisteredAccount', null)
            })
          } else {
            this.$store.commit('setRegisteredAccount', null)
          }
        }).catch(() => {
          this.$store.commit('setRegisteredAccount', null)
        })
      } else {
        this.$store.commit('setRegisteredAccount', null)
      }
    }
  }
}
</script>
